{"ast":null,"code":"var _jsxFileName = \"/home/ice/tempmvp/src/general/Login.js\";\nimport React, { Component } from \"react\";\nimport \"./Login.css\";\nimport logo from \"../images/logo.png\";\nimport eye from \"../images/see-icon.png\";\nimport { connect } from \"react-redux\";\nimport { Auth } from \"aws-amplify\";\nimport { Redirect } from \"react-router-dom\";\nimport ChangePassword from \"./ChangePassword\";\nimport Loading from \"./Loading\";\nimport queryString from \"query-string\";\nimport Dropdown from \"../general/form_components/Dropdown\";\nimport Navbar from \"../landingComponents/Navbar\";\n\nclass Login extends Component {\n  constructor(props) {\n    super(props);\n\n    this.componentDidMount = () => {\n      window.analytics.page('login');\n    };\n\n    this.validateForm = () => {\n      return this.state.username.length > 0 && this.state.password.length > 0;\n    };\n\n    this.handleChange = event => {\n      if (event.target.id !== 'password') {\n        event.target.value = event.target.value.toLowerCase();\n      }\n\n      this.setState({\n        [event.target.id]: event.target.value\n      }, () => {\n        console.log(this.state);\n      });\n    };\n\n    this.handleSubmit = async event => {\n      this.setState({\n        loading: true\n      });\n      console.log('submitting');\n      event.preventDefault();\n\n      try {\n        var user = await Auth.signIn(this.state.username, this.state.password);\n\n        if (user.challengeName === 'NEW_PASSWORD_REQUIRED') {\n          this.setState({\n            panel: \"changePassword\"\n          });\n        } else {\n          this.props.dispatchLogin();\n          console.log(this.props.logged_in);\n          Auth.currentSession().then(data => {// console.log('session data:', user)\n          });\n          this.setState({\n            redirect: this.props.location.state ? this.props.location.state.from : '/app'\n          }, () => {\n            console.log('redirected');\n          });\n        }\n      } catch (err) {\n        //   if (err.code === 'UserNotConfirmedException') {\n        //     // The error happens if the user didn't finish the confirmation step when signing up\n        //     // In this case you need to resend the code and confirm the user\n        //     // About how to resend the code and confirm the user, please check the signUp part\n        // } else if (err.code === 'PasswordResetRequiredException') {\n        //     // The error happens when the password is reset in the Cognito console\n        //     // In this case you need to call forgotPassword to reset the password\n        //     // Please check the Forgot Password part.\n        // } else if (err.code === 'NotAuthorizedException') {\n        //     // The error happens when the incorrect password is provided\n        // } else if (err.code === 'UserNotFoundException') {\n        //     // The error happens when the supplied username/email does not exist in the Cognito user pool\n        // } else {\n        this.setState({\n          error: 'Incorrect username or password'\n        });\n        console.log(err); // }\n      }\n\n      this.setState({\n        loading: false\n      });\n    };\n\n    this.showPassword = () => {\n      var type = this.state.passwordFieldType;\n      var newType = type === \"password\" ? \"input\" : \"password\";\n      this.setState({\n        passwordFieldType: newType\n      });\n      console.log(this.state);\n    };\n\n    this.renderRedirect = () => {\n      if (this.state.redirect) {\n        console.log('redirecting to:', this.state.redirect);\n        return React.createElement(Redirect, {\n          to: this.state.redirect,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 108\n          },\n          __self: this\n        });\n      }\n    };\n\n    this.getPanel = () => {\n      // console.log(this.state)\n      console.log('login props:', this.props);\n\n      switch (this.state.panel) {\n        case \"login\":\n          return React.createElement(React.Fragment, null, this.renderRedirect(), React.createElement(\"div\", {\n            className: \"slide\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 120\n            },\n            __self: this\n          }, React.createElement(\"div\", {\n            className: \"form-container\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 121\n            },\n            __self: this\n          }, React.createElement(\"img\", {\n            src: logo,\n            className: \"main-logo\",\n            alt: \"\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 122\n            },\n            __self: this\n          }), React.createElement(\"div\", {\n            className: \"field-container long-field-title\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 123\n            },\n            __self: this\n          }, React.createElement(\"div\", {\n            className: \"field-title \",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 124\n            },\n            __self: this\n          }, React.createElement(\"strong\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 125\n            },\n            __self: this\n          }, \"Username\")), React.createElement(\"input\", {\n            type: \"text\",\n            id: \"username\",\n            value: this.state.username,\n            className: \"text-response\",\n            placeholder: \"\",\n            onChange: this.handleChange,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 127\n            },\n            __self: this\n          })), React.createElement(\"div\", {\n            className: \"field-container \",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 129\n            },\n            __self: this\n          }, React.createElement(\"div\", {\n            className: \"field-title\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 130\n            },\n            __self: this\n          }, React.createElement(\"strong\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 131\n            },\n            __self: this\n          }, \"Password\")), React.createElement(\"br\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 133\n            },\n            __self: this\n          }), React.createElement(\"div\", {\n            className: \"password-field\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 134\n            },\n            __self: this\n          }, React.createElement(\"input\", {\n            type: this.state.passwordFieldType,\n            id: \"password\",\n            value: this.state.password,\n            className: \"text-response\",\n            placeholder: \"\",\n            onChange: this.handleChange,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 135\n            },\n            __self: this\n          }), React.createElement(\"img\", {\n            src: eye,\n            id: \"passwordShow\",\n            className: \"btn passwordShow\",\n            onClick: this.showPassword,\n            alt: \"\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 136\n            },\n            __self: this\n          }))), React.createElement(\"div\", {\n            className: \"form-error\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 139\n            },\n            __self: this\n          }, this.state.error), React.createElement(\"div\", {\n            className: \"small get-details\",\n            onClick: () => {\n              this.setState({\n                panel: 'get-details'\n              });\n            },\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 140\n            },\n            __self: this\n          }, \"Don't know your details?\"), React.createElement(\"button\", {\n            className: \"submit-form\",\n            type: \"submit\",\n            onClick: this.handleSubmit,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 143\n            },\n            __self: this\n          }, this.state.loading ? React.createElement(Loading, {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 146\n            },\n            __self: this\n          }) : \"Submit\"))));\n\n        case \"changePassword\":\n          if (!this.state.user) {\n            var user = Auth.signIn(this.state.username, this.state.password).then(user => {\n              this.setState({\n                user: user\n              });\n            });\n          }\n\n          console.log('user:', this.state.user);\n          return this.state.user ? React.createElement(ChangePassword, {\n            user: this.state.user,\n            from: this.props.location.state ? this.props.location.state.from : null,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 165\n            },\n            __self: this\n          }) : null;\n\n        case \"get-details\":\n          return React.createElement(React.Fragment, null, this.renderRedirect(), React.createElement(\"div\", {\n            className: \"slide\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 171\n            },\n            __self: this\n          }, React.createElement(\"div\", {\n            className: \"form-container\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 172\n            },\n            __self: this\n          }, React.createElement(\"img\", {\n            src: logo,\n            className: \"main-logo\",\n            alt: \"\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 173\n            },\n            __self: this\n          }), React.createElement(\"div\", {\n            className: \"field-container long-field-title\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 174\n            },\n            __self: this\n          }, React.createElement(\"div\", {\n            className: \"field-title \",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 175\n            },\n            __self: this\n          }, React.createElement(\"strong\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 176\n            },\n            __self: this\n          }, \"Enter your contact email\")), React.createElement(\"input\", {\n            className: \"text-response\",\n            prompt: \"email\",\n            value: this.state.username,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 178\n            },\n            __self: this\n          })), React.createElement(\"button\", {\n            className: \"submit-form\",\n            onClick: this.handleSubmit,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 180\n            },\n            __self: this\n          }, this.state.loading ? React.createElement(Loading, {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 183\n            },\n            __self: this\n          }) : \"Send verification code\"))));\n\n        default:\n          return null;\n      }\n    };\n\n    var params = queryString.parse(window.location.search); // console.log('params:', params)\n\n    this.state = {\n      username: params.u ? params.u : \"\",\n      password: params.p ? params.p : \"\",\n      passwordFieldType: \"password\",\n      redirect: null,\n      panel: \"login\",\n      user: null,\n      loading: false,\n      error: null\n    };\n  }\n\n  render() {\n    return React.createElement(React.Fragment, null, React.createElement(\"div\", {\n      className: \"panel\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 201\n      },\n      __self: this\n    }, this.getPanel()));\n  }\n\n}\n\nconst mapStateToProps = state => {\n  return {\n    logged_in: state.user.logged_in\n  };\n};\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    dispatchLogin: () => {\n      dispatch({\n        type: \"LOG_IN\"\n      });\n    }\n  };\n};\n\nexport default Login = connect(mapStateToProps, mapDispatchToProps)(Login);","map":{"version":3,"sources":["/home/ice/tempmvp/src/general/Login.js"],"names":["React","Component","logo","eye","connect","Auth","Redirect","ChangePassword","Loading","queryString","Dropdown","Navbar","Login","constructor","props","componentDidMount","window","analytics","page","validateForm","state","username","length","password","handleChange","event","target","id","value","toLowerCase","setState","console","log","handleSubmit","loading","preventDefault","user","signIn","challengeName","panel","dispatchLogin","logged_in","currentSession","then","data","redirect","location","from","err","error","showPassword","type","passwordFieldType","newType","renderRedirect","getPanel","params","parse","search","u","p","render","mapStateToProps","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport \"./Login.css\"\nimport logo from \"../images/logo.png\"\nimport eye from \"../images/see-icon.png\"\nimport { connect } from \"react-redux\"\nimport { Auth } from \"aws-amplify\"\nimport { Redirect } from \"react-router-dom\"\nimport ChangePassword from \"./ChangePassword\"\nimport Loading from \"./Loading\"\nimport queryString from \"query-string\"\nimport Dropdown from \"../general/form_components/Dropdown\";\nimport Navbar from \"../landingComponents/Navbar\"\n\nclass Login extends Component {\n  constructor(props) {\n    super(props);\n    var params = queryString.parse(window.location.search)\n    // console.log('params:', params)\n    this.state = {\n      username: params.u ? params.u : \"\",\n      password: params.p ? params.p : \"\",\n      passwordFieldType: \"password\",\n      redirect: null,\n      panel: \"login\",\n      user: null,\n      loading: false,\n      error: null\n    };\n  }\n\n  componentDidMount = () => {\n      window.analytics.page('login')\n  }\n\n  validateForm = () => {\n    return this.state.username.length > 0 && this.state.password.length > 0;\n  }\n\n  handleChange = event => {\n    if (event.target.id !== 'password') {event.target.value = event.target.value.toLowerCase()}\n    this.setState({\n      [event.target.id]: event.target.value\n    },\n      () => {\n          console.log(this.state)\n      }\n    );\n  }\n\n  handleSubmit = async event => {\n    this.setState({loading: true})\n    console.log('submitting')\n    event.preventDefault();\n    try {\n      var user = await Auth.signIn(\n        this.state.username,\n        this.state.password\n      )\n      if (user.challengeName === 'NEW_PASSWORD_REQUIRED') {\n          this.setState({panel: \"changePassword\"})\n      }\n      else {\n        this.props.dispatchLogin()\n        console.log(this.props.logged_in)\n        Auth.currentSession()\n        .then(\n          data => {\n            // console.log('session data:', user)\n          }\n        )\n        this.setState({redirect: this.props.location.state ? this.props.location.state.from : '/app'},\n          () => {\n              console.log('redirected')\n          }\n        )\n      }\n    } catch (err) {\n    //   if (err.code === 'UserNotConfirmedException') {\n    //     // The error happens if the user didn't finish the confirmation step when signing up\n    //     // In this case you need to resend the code and confirm the user\n    //     // About how to resend the code and confirm the user, please check the signUp part\n    // } else if (err.code === 'PasswordResetRequiredException') {\n    //     // The error happens when the password is reset in the Cognito console\n    //     // In this case you need to call forgotPassword to reset the password\n    //     // Please check the Forgot Password part.\n    // } else if (err.code === 'NotAuthorizedException') {\n    //     // The error happens when the incorrect password is provided\n    // } else if (err.code === 'UserNotFoundException') {\n    //     // The error happens when the supplied username/email does not exist in the Cognito user pool\n    // } else {\n        this.setState({error: 'Incorrect username or password'})\n        console.log(err);\n    // }\n    }\n    this.setState({loading: false})\n  }\n\n  showPassword = () => {\n    var type = this.state.passwordFieldType\n    var newType = type === \"password\" ? \"input\" : \"password\"\n    this.setState({passwordFieldType: newType})\n    console.log(this.state)\n  }\n\n  renderRedirect = () => {\n    if (this.state.redirect) {\n      console.log('redirecting to:', this.state.redirect)\n      return <Redirect to={this.state.redirect} />\n    }\n  }\n\n  getPanel = () => {\n    // console.log(this.state)\n    console.log('login props:', this.props)\n    switch (this.state.panel) {\n      case \"login\":\n        return (\n          <>\n          {this.renderRedirect()}\n            <div className=\"slide\">\n            <div className=\"form-container\">\n                <img src={ logo } className=\"main-logo\" alt=\"\" />\n                <div className=\"field-container long-field-title\">\n                    <div className=\"field-title \">\n                        <strong>Username</strong>\n                    </div>\n                    <input type=\"text\" id=\"username\" value={this.state.username} className=\"text-response\" placeholder=\"\" onChange={ this.handleChange }/>\n                </div>\n                <div className=\"field-container \">\n                    <div className=\"field-title\">\n                      <strong>Password</strong>\n                    </div>\n                    <br/>\n                    <div className=\"password-field\">\n                      <input type={ this.state.passwordFieldType } id=\"password\" value={this.state.password} className=\"text-response\" placeholder=\"\"  onChange={ this.handleChange }/>\n                      <img src={ eye } id=\"passwordShow\" className=\"btn passwordShow\" onClick={ this.showPassword } alt=\"\" />\n                    </div>\n                  </div>\n                  <div className=\"form-error\">{this.state.error}</div>\n                  <div className=\"small get-details\" onClick={() => {this.setState({panel: 'get-details'})}}>\n                      Don't know your details?\n                  </div>\n                  <button className=\"submit-form\" type=\"submit\" onClick={this.handleSubmit}>\n                      {\n                        this.state.loading ?\n                        <Loading /> :\n                        \"Submit\"\n                      }\n                  </button>\n                </div>\n\n            </div>\n          </>\n        )\n      case \"changePassword\":\n        if (!this.state.user) {\n            var user = Auth.signIn(this.state.username, this.state.password)\n            .then(\n              (user) => {\n                this.setState({user: user})\n              }\n            )\n        }\n        console.log('user:', this.state.user)\n        return this.state.user ? <ChangePassword user={this.state.user} from={this.props.location.state ? this.props.location.state.from : null}/> : null\n      case \"get-details\":\n        return (\n          <>\n\n          {this.renderRedirect()}\n          <div className=\"slide\">\n          <div className=\"form-container\">\n              <img src={ logo } className=\"main-logo\" alt=\"\" />\n              <div className=\"field-container long-field-title\">\n                  <div className=\"field-title \">\n                      <strong>Enter your contact email</strong>\n                  </div>\n                  <input className=\"text-response\" prompt=\"email\" value={this.state.username} /> \n              </div>\n                <button className=\"submit-form\" onClick={this.handleSubmit}>\n                    {\n                      this.state.loading ?\n                      <Loading /> :\n                      \"Send verification code\"\n                    }\n                </button>\n              </div>\n          </div>\n          </>\n        )\n\n      default:\n        return null\n    }\n  }\n\n  render() {\n    return (\n      <>\n      {/* <Navbar /> */}\n          <div className=\"panel\" >\n          {/* // style={{backgroundColor: 'var(--green)', width: '400px', margin: 'auto', padding: '20px'}}> */}\n            {this.getPanel()}\n          </div>\n      </>\n    )\n  }\n}\n\nconst mapStateToProps = (state) => {\n  return {\n    logged_in: state.user.logged_in\n  }\n}\n\nconst mapDispatchToProps = (dispatch) => {\n    return {\n        dispatchLogin: () => {\n            dispatch({\n                type: \"LOG_IN\"\n            })\n        }\n    }\n}\n\nexport default Login = connect(mapStateToProps, mapDispatchToProps)(Login)"]},"metadata":{},"sourceType":"module"}